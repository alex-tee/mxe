image: ubuntu/18.04
packages:
  - autoconf
  - automake
  - autopoint
  - bash
  - bison
  - bzip2
  - flex
  - g++
  - g++-multilib
  - gettext
  - git
  - gperf
  - intltool
  - libc6-dev-i386
  - libgdk-pixbuf2.0-dev
  - libltdl-dev
  - libssl-dev
  - libtool-bin
  - libxml-parser-perl
  - lzip
  - make
  - openssl
  - p7zip-full
  - patch
  - perl
  - pkg-config
  - python
  - ruby
  - sed
  - unzip
  - wget
  - xz-utils
  - rsync
sources:
  - https://git.sr.ht/~alextee/mxe
secrets:
  - 063cb70d-6da6-492a-b530-04edc07651ba
tasks:
  - build: |
      cd mxe
      make MXE_TARGETS='x86_64-w64-mingw32.static' JOBS=5 -j5 carla
  - deploy: |
      cd mxe
      prefix="usr/x86_64-w64-mingw32.static"
      tmpdir=carla-tmp
      mkdir -p $tmpdir/include
      mkdir -p $tmpdir/lib/pkgconfig
      cp -R $prefix/include/carla $tmpdir/include/
      cp -R $prefix/lib/carla $tmpdir/lib/
      cp $prefix/lib/pkgconfig/carla* $tmpdir/lib/pkgconfig/
      cp src/carla.mk $tmpdir/version.txt
      cd $tmpdir
      zip carla.zip -r ./*
      sshopts="ssh -o StrictHostKeyChecking=no"
      rsync --rsh="$sshopts" -rP carla.zip srht@mail.zrythm.org:~/
